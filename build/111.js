webpackJsonp([111],{2069:function(n,l,t){"use strict";function a(n){return s._42(0,[(n()(),s._16(0,0,null,null,4,"button",[["clear",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,t){var a=!0;if("click"===l){a=!1!==n.component.save(t)&&a}return a},Z.b,Z.a)),s._15(1,1097728,[[2,4]],0,nn.a,[[8,""],ln.a,s.p,s.K],{clear:[0,"clear"]},null),s._32(131072,tn.a,[an.a,s.i]),(n()(),s._40(3,0,["\n                ","\n            "])),s._32(131072,tn.a,[an.a,s.i])],function(n,l){n(l,1,0,"")},function(n,l){n(l,0,0,s._41(l,0,0,s._29(l,2).transform("core.save")));n(l,3,0,s._41(l,3,0,s._29(l,4).transform("core.save")))})}function e(n){return s._42(0,[(n()(),s._16(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),s._15(1,16384,[[3,4]],0,en.a,[ln.a,s.p,s.K,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),s._40(2,null,["",""])),s._32(131072,tn.a,[an.a,s.i])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,s._41(l,2,0,s._29(l,3).transform("core.groupsseparate")))})}function i(n){return s._42(0,[(n()(),s._16(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),s._15(1,16384,[[3,4]],0,en.a,[ln.a,s.p,s.K,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),s._40(2,null,["",""])),s._32(131072,tn.a,[an.a,s.i])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,s._41(l,2,0,s._29(l,3).transform("core.groupsvisible")))})}function r(n){return s._42(0,[(n()(),s._16(0,0,null,null,2,"ion-option",[],null,null,null,null,null)),s._15(1,16384,[[6,4]],0,rn.a,[s.p],{value:[0,"value"]},null),(n()(),s._40(2,null,["",""]))],function(n,l){n(l,1,0,l.context.$implicit.id)},function(n,l){n(l,2,0,l.context.$implicit.name)})}function u(n){return s._42(0,[(n()(),s._16(0,0,null,null,24,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,un.b,un.a)),s._15(1,1097728,null,3,on.a,[dn.a,ln.a,s.p,s.K,[2,sn.a]],null,null),s._37(603979776,3,{contentLabel:0}),s._37(603979776,4,{_buttons:1}),s._37(603979776,5,{_icons:1}),s._15(5,16384,null,0,cn.a,[],null,null),(n()(),s._40(-1,2,["\n            "])),(n()(),s._11(16777216,null,1,1,null,e)),s._15(8,16384,null,0,fn.k,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(n()(),s._40(-1,2,["\n            "])),(n()(),s._11(16777216,null,1,1,null,i)),s._15(11,16384,null,0,fn.k,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(n()(),s._40(-1,2,["\n            "])),(n()(),s._16(13,0,null,3,10,"ion-select",[["aria-labelledby","addon-data-groupslabel"],["interface","action-sheet"]],[[2,"select-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionChange"],[null,"click"],[null,"keyup.space"]],function(n,l,t){var a=!0,e=n.component;if("click"===l){a=!1!==s._29(n,14)._click(t)&&a}if("keyup.space"===l){a=!1!==s._29(n,14)._keyup()&&a}if("ngModelChange"===l){a=!1!==(e.selectedGroup=t)&&a}if("ionChange"===l){a=!1!==e.setGroup(e.selectedGroup)&&a}return a},_n.b,_n.a)),s._15(14,1228800,null,1,pn.a,[hn.a,dn.a,ln.a,s.p,s.K,[2,on.a],gn.a],{interface:[0,"interface"]},{ionChange:"ionChange"}),s._37(603979776,6,{options:1}),s._35(1024,null,m.l,function(n){return[n]},[pn.a]),s._15(17,671744,null,0,m.q,[[8,null],[8,null],[8,null],[2,m.l]],{model:[0,"model"]},{update:"ngModelChange"}),s._35(2048,null,m.m,null,[m.q]),s._15(19,16384,null,0,m.n,[m.m],null,null),(n()(),s._40(-1,null,["\n                "])),(n()(),s._11(16777216,null,null,1,null,r)),s._15(22,802816,null,0,fn.j,[s.W,s.T,s.v],{ngForOf:[0,"ngForOf"]},null),(n()(),s._40(-1,null,["\n            "])),(n()(),s._40(-1,2,["\n        "]))],function(n,l){var t=l.component;n(l,8,0,t.groupInfo.separateGroups);n(l,11,0,t.groupInfo.visibleGroups);n(l,14,0,"action-sheet");n(l,17,0,t.selectedGroup);n(l,22,0,t.groupInfo.groups)},function(n,l){n(l,13,0,s._29(l,14)._disabled,s._29(l,19).ngClassUntouched,s._29(l,19).ngClassTouched,s._29(l,19).ngClassPristine,s._29(l,19).ngClassDirty,s._29(l,19).ngClassValid,s._29(l,19).ngClassInvalid,s._29(l,19).ngClassPending)})}function o(n){return s._42(0,[(n()(),s._16(0,0,null,null,14,"div",[],[[8,"className",0]],null,null,null,null)),(n()(),s._40(-1,null,["\n            "])),(n()(),s._16(2,0,null,null,1,"core-style",[],null,null,null,mn.b,mn.a)),s._15(3,573440,null,0,vn.a,[s.p],{css:[0,"css"],prefix:[1,"prefix"]},null),(n()(),s._40(-1,null,["\n\n            "])),(n()(),s._16(5,0,null,null,8,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,l,t){var a=!0,e=n.component;if("submit"===l){a=!1!==s._29(n,7).onSubmit(t)&&a}if("reset"===l){a=!1!==s._29(n,7).onReset()&&a}if("ngSubmit"===l){a=!1!==e.save(t)&&a}return a},null,null)),s._15(6,16384,null,0,m.w,[],null,null),s._15(7,540672,null,0,m.h,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),s._35(2048,null,m.b,null,[m.h]),s._15(9,16384,null,0,m.o,[m.b],null,null),(n()(),s._40(-1,null,["\n                "])),(n()(),s._16(11,0,null,null,1,"core-compile-html",[],null,null,null,yn.b,yn.a)),s._15(12,966656,null,0,bn.a,[In.a,s.i,s.p,[2,Pn.a],s.w,y.a,v.a],{text:[0,"text"],jsData:[1,"jsData"],extraImports:[2,"extraImports"]},null),(n()(),s._40(-1,null,["\n            "])),(n()(),s._40(-1,null,["\n        "]))],function(n,l){var t=l.component;n(l,3,0,t.data.csstemplate,s._19(1,".addon-data-entries-",t.data.id,""));n(l,7,0,t.editForm);n(l,12,0,t.editFormRender,t.jsData,t.extraImports)},function(n,l){n(l,0,0,s._19(1,"addon-data-contents addon-data-entries-",l.component.data.id,""));n(l,5,0,s._29(l,9).ngClassUntouched,s._29(l,9).ngClassTouched,s._29(l,9).ngClassPristine,s._29(l,9).ngClassDirty,s._29(l,9).ngClassValid,s._29(l,9).ngClassInvalid,s._29(l,9).ngClassPending)})}function d(n){return s._42(0,[s._37(402653184,1,{content:0}),(n()(),s._16(1,0,null,null,20,"ion-header",[],null,null,null,null,null)),s._15(2,16384,null,0,Cn.a,[ln.a,s.p,s.K,[2,En.a]],null,null),(n()(),s._40(-1,null,["\n    "])),(n()(),s._16(4,0,null,null,16,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,Dn.b,Dn.a)),s._15(5,49152,null,0,Tn.a,[hn.a,[2,En.a],[2,Pn.a],ln.a,s.p,s.K],null,null),s._15(6,212992,null,0,Fn.a,[Tn.a,xn.a,an.a,P.a],null,null),(n()(),s._40(-1,3,["\n        "])),(n()(),s._16(8,0,null,3,3,"ion-title",[],null,null,null,wn.b,wn.a)),s._15(9,49152,null,0,Gn.a,[ln.a,s.p,s.K,[2,kn.a],[2,Tn.a]],null,null),(n()(),s._16(10,0,null,0,1,"core-format-text",[],null,null,null,null,null)),s._15(11,540672,null,0,An.a,[s.p,b.a,y.a,Un.a,an.a,xn.a,v.a,jn.a,Hn.a,Kn.a,Ln.a,Mn.a,[2,Pn.a],[2,Rn.a],[2,Sn.a],On.a,P.a],{text:[0,"text"]},null),(n()(),s._40(-1,3,["\n        "])),(n()(),s._16(13,0,null,2,6,"ion-buttons",[["end",""]],null,null,null,null,null)),s._15(14,16384,null,1,Nn.a,[ln.a,s.p,s.K,[2,kn.a],[2,Tn.a]],null,null),s._37(603979776,2,{_buttons:1}),(n()(),s._40(-1,null,["\n            "])),(n()(),s._11(16777216,null,null,1,null,a)),s._15(18,16384,null,0,fn.k,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(n()(),s._40(-1,null,["\n        "])),(n()(),s._40(-1,3,["\n    "])),(n()(),s._40(-1,null,["\n"])),(n()(),s._40(-1,null,["\n"])),(n()(),s._16(23,0,null,null,12,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Wn.b,Wn.a)),s._15(24,4374528,[[1,4]],0,Rn.a,[ln.a,xn.a,$n.a,s.p,s.K,hn.a,Vn.a,s.D,[2,En.a],[2,Pn.a]],null,null),(n()(),s._40(-1,1,["\n    "])),(n()(),s._16(26,0,null,1,8,"core-loading",[],null,null,null,qn.b,qn.a)),s._15(27,638976,null,0,Bn.a,[an.a,s.p,P.a,v.a],{hideUntil:[0,"hideUntil"]},null),(n()(),s._40(-1,0,["\n        "])),(n()(),s._11(16777216,null,0,1,null,u)),s._15(30,16384,null,0,fn.k,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(n()(),s._40(-1,0,["\n\n        "])),(n()(),s._11(16777216,null,0,1,null,o)),s._15(33,16384,null,0,fn.k,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(n()(),s._40(-1,0,["\n    "])),(n()(),s._40(-1,1,["\n"])),(n()(),s._40(-1,null,["\n"]))],function(n,l){var t=l.component;n(l,6,0);n(l,11,0,t.title);n(l,18,0,t.entry);n(l,27,0,t.loaded);n(l,30,0,t.groupInfo&&(t.groupInfo.separateGroups||t.groupInfo.visibleGroups));n(l,33,0,t.data)},function(n,l){n(l,4,0,s._29(l,5)._hidden,s._29(l,5)._sbPadding);n(l,23,0,s._29(l,24).statusbarPadding,s._29(l,24)._hasRefresher)})}Object.defineProperty(l,"__esModule",{value:!0});var s=t(1),c=(t(0),t(7),t(4)),f=t(32),_=t(30),p=t(370),h=t(475),g=t(474),m=t(23),v=t(3),y=t(5),b=t(2),I=t(68),P=t(12),C=t(69),E=t(15),D=t(98),T=t(216),F=t(287),x=t(124),w=t(156),G=function(){function n(n,l,t,a,e,i,r,u,o,d,s,c,f,_,p){this.utils=l,this.groupsProvider=t,this.domUtils=a,this.fieldsDelegate=e,this.courseProvider=i,this.dataProvider=r,this.dataOffline=u,this.dataHelper=o,this.navCtrl=s,this.translate=c,this.eventsProvider=f,this.fileUploaderProvider=_,this.tagProvider=p,this.fields={},this.fieldsArray=[],this.forceLeave=!1,this.title="",this.component=D.a.COMPONENT,this.loaded=!1,this.selectedGroup=0,this.cssClass="",this.editFormRender="",this.extraImports=[g.a],this.errors={},this.module=n.get("module")||{},this.entryId=n.get("entryId")||null,this.courseId=n.get("courseId"),this.selectedGroup=n.get("group")||0,this.siteId=d.getCurrentSiteId(),this.title=this.module.name,this.editForm=new m.g({})}return n.prototype.ionViewDidLoad=function(){this.fetchEntryData()},n.prototype.ionViewCanLeave=function(){var n=this;if(this.forceLeave||!this.entry)return!0;var l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){return l?n.domUtils.showConfirm(n.translate.instant("core.confirmcanceledit")):Promise.resolve()}).then(function(){return n.dataHelper.getEditTmpFiles(l,n.fieldsArray,n.data.id,n.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)})})},n.prototype.fetchEntryData=function(){var n=this;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(l){return n.title=l.name||n.title,n.data=l,n.cssClass="addon-data-entries-"+l.id,n.dataProvider.getDatabaseAccessInformation(l.id)}).then(function(l){if(n.entryId)return n.groupsProvider.getActivityGroupInfo(n.data.coursemodule).then(function(l){n.groupInfo=l,n.selectedGroup=n.groupsProvider.validateGroupId(n.selectedGroup,l)})}).then(function(){return n.dataProvider.getFields(n.data.id)}).then(function(l){return n.fieldsArray=l,n.fields=n.utils.arrayToObject(l,"id"),n.dataHelper.fetchEntry(n.data,l,n.entryId)}).then(function(l){n.entry=l.entry,n.editFormRender=n.displayEditFields()}).catch(function(l){n.domUtils.showErrorModalDefault(l,"core.course.errorgetmodule",!0)}).finally(function(){n.loaded=!0})},n.prototype.save=function(n){var l=this;n.preventDefault(),n.stopPropagation();var t=this.editForm.value;return this.dataHelper.hasEditDataChanged(t,this.fieldsArray,this.data.id,this.entry.contents).then(function(n){if(!n)return l.entryId?l.returnToEntryList():Promise.reject("addon.mod_data.emptyaddform");var a=l.domUtils.showModalLoading("core.sending",!0),e=l.entryId?l.entryId:-(new Date).getTime();return l.dataHelper.getEditDataFromForm(t,l.fieldsArray,l.data.id,e,l.entry.contents,l.offline).catch(function(n){return l.offline?Promise.reject(n):(l.offline=!0,l.dataHelper.getEditDataFromForm(t,l.fieldsArray,l.data.id,e,l.entry.contents,l.offline))}).then(function(n){return n.length>0&&(l.entryId?l.dataProvider.editEntry(l.data.id,l.entryId,l.courseId,n,l.fields,void 0,l.offline):l.dataProvider.addEntry(l.data.id,e,l.courseId,n,l.selectedGroup,l.fields,void 0,l.offline))}).then(function(n){if(!n)return Promise.reject("addon.mod_data.emptyaddform");if(l.entryId&&n.updated||!l.entryId&&n.newentryid){var t=[];return l.entryId=l.entryId||n.newentryid,t.push(l.dataProvider.invalidateEntryData(l.data.id,l.entryId,l.siteId)),t.push(l.dataProvider.invalidateEntriesData(l.data.id,l.siteId)),Promise.all(t).then(function(){l.eventsProvider.trigger(D.a.ENTRY_CHANGED,{dataId:l.data.id,entryId:l.entryId},l.siteId)}).finally(function(){return l.returnToEntryList()})}l.errors={},n.fieldnotifications&&n.fieldnotifications.forEach(function(n){var t=l.fieldsArray.find(function(l){return l.name==n.fieldname});t&&(l.errors[t.id]=n.notification)}),l.jsData.errors=l.errors,setTimeout(function(){l.scrollToFirstError()})}).finally(function(){a.dismiss()})}).catch(function(n){l.domUtils.showErrorModalDefault(n,"Cannot edit entry",!0)})},n.prototype.setGroup=function(n){return this.selectedGroup=n,this.loaded=!1,this.fetchEntryData()},n.prototype.displayEditFields=function(){this.jsData={fields:this.fields,contents:this.utils.clone(this.entry.contents),form:this.editForm,data:this.data,errors:this.errors};var n,l=this.dataHelper.getTemplate(this.data,"addtemplate",this.fieldsArray);this.fieldsArray.forEach(function(t){n=(n="[["+t.name+"]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,'<addon-mod-data-field-plugin mode="edit" [field]="fields['+t.id+']"                [value]="contents['+t.id+']" [form]="form" [database]="data" [error]="errors['+t.id+']">                </addon-mod-data-field-plugin>'),n=(n="[["+t.name+"#id]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,"field_"+t.id)}),n=new RegExp("##tags##","gi");return l=l.replace(n,this.tagProvider.areTagsAvailableInSite()?"<p class=\"item-dimmed\">{{ 'addon.mod_data.edittagsnotsupported' | translate }}</p>":"")},n.prototype.returnToEntryList=function(){var n=this;return this.dataHelper.getEditTmpFiles(this.editForm.value,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)}).finally(function(){n.forceLeave=!0,n.navCtrl.pop()})},n.prototype.scrollToFirstError=function(){this.domUtils.scrollToElementBySelector(this.content,".addon-data-error")||this.domUtils.scrollToTop(this.content)},n}(),k=function(){return function(){}}(),A=t(1471),U=t(1472),j=t(1473),H=t(1474),K=t(1475),L=t(1476),M=t(1477),R=t(1478),S=t(1479),O=t(1480),N=t(1481),W=t(1482),$=t(1483),V=t(1486),q=t(1487),B=t(1484),J=t(1485),Y=t(1488),z=t(480),Q=t(1490),X=t(1501),Z=t(45),nn=t(43),ln=t(8),tn=t(28),an=t(19),en=t(64),rn=t(103),un=t(31),on=t(22),dn=t(21),sn=t(29),cn=t(33),fn=t(9),_n=t(121),pn=t(104),hn=t(35),gn=t(56),mn=t(1538),vn=t(491),yn=t(217),bn=t(189),In=t(147),Pn=t(20),Cn=t(365),En=t(39),Dn=t(713),Tn=t(209),Fn=t(471),xn=t(17),wn=t(714),Gn=t(307),kn=t(245),An=t(42),Un=t(11),jn=t(24),Hn=t(6),Kn=t(18),Ln=t(10),Mn=t(14),Rn=t(27),Sn=t(26),On=t(38),Nn=t(366),Wn=t(179),$n=t(34),Vn=t(102),qn=t(51),Bn=t(48),Jn=t(72),Yn=s._14({encapsulation:2,styles:[],data:{}}),zn=s._12("page-addon-mod-data-edit",G,function(n){return s._42(0,[(n()(),s._16(0,0,null,null,1,"page-addon-mod-data-edit",[],null,null,null,d,Yn)),s._15(1,49152,null,0,G,[Jn.a,v.a,I.a,y.a,x.a,E.a,D.a,F.a,T.a,b.a,Pn.a,an.a,P.a,C.a,w.a],null,null)],null,null)},{},{},[]),Qn=t(361),Xn=t(362),Zn=t(364),nl=t(363),ll=t(470),tl=t(712),al=t(110),el=t(269),il=t(71),rl=t(271),ul=t(268);t.d(l,"AddonModDataEditPageModuleNgFactory",function(){return ol});var ol=s._13(k,[],function(n){return s._25([s._26(512,s.n,s._6,[[8,[A.a,U.a,j.a,H.a,K.a,L.a,M.a,R.a,S.a,O.a,N.a,W.a,$.a,V.a,q.a,B.a,J.a,Y.a,z.a,Q.a,X.a,zn]],[3,s.n],s.B]),s._26(4608,fn.m,fn.l,[s.x,[2,fn.w]]),s._26(4608,m.x,m.x,[]),s._26(4608,m.d,m.d,[]),s._26(4608,Qn.b,Qn.a,[]),s._26(4608,Xn.a,Xn.b,[]),s._26(4608,Zn.b,Zn.a,[]),s._26(4608,nl.b,nl.a,[]),s._26(4608,an.a,an.a,[ll.a,Qn.b,Xn.a,Zn.b,nl.b,an.b,an.c]),s._26(512,f.a,f.a,[]),s._26(512,fn.b,fn.b,[]),s._26(512,m.v,m.v,[]),s._26(512,m.i,m.i,[]),s._26(512,m.s,m.s,[]),s._26(512,tl.a,tl.a,[]),s._26(512,c.a,c.a,[]),s._26(512,al.a,al.a,[]),s._26(512,_.a,_.a,[]),s._26(512,el.a,el.a,[]),s._26(512,il.a,il.a,[]),s._26(512,h.a,h.a,[]),s._26(512,p.a,p.a,[]),s._26(512,rl.a,rl.a,[]),s._26(512,g.a,g.a,[]),s._26(512,tl.b,tl.b,[]),s._26(512,k,k,[]),s._26(256,an.c,void 0,[]),s._26(256,an.b,void 0,[]),s._26(256,ul.a,G,[])])})}});