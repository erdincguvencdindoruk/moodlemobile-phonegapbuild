webpackJsonp([1],{2065:function(n,e,t){"use strict";function s(n){return v._42(0,[(n()(),v._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function l(n){return v._42(0,[(n()(),v._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function a(n){return v._42(0,[(n()(),v._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function i(n){return v._42(0,[(n()(),v._16(0,0,null,null,18,"ion-list",[],null,null,null,null,null)),v._15(1,16384,null,0,F.a,[G.a,v.p,v.K,z.a,j.l,J.a],null,null),(n()(),v._40(-1,null,["\n                "])),(n()(),v._11(16777216,null,null,2,null,s)),v._15(4,540672,null,0,Z.r,[v.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),v._33(5,{item:0}),(n()(),v._40(-1,null,["\n                "])),(n()(),v._11(16777216,null,null,2,null,l)),v._15(8,540672,null,0,Z.r,[v.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),v._33(9,{item:0}),(n()(),v._40(-1,null,["\n                "])),(n()(),v._11(16777216,null,null,2,null,a)),v._15(12,540672,null,0,Z.r,[v.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),v._33(13,{item:0}),(n()(),v._40(-1,null,["\n                "])),(n()(),v._40(-1,null,["\n                "])),(n()(),v._16(16,0,null,null,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,e,t){var s=!0,l=n.component;if("action"===e){s=!1!==l.search(l.query,"messages",t)&&s}return s},Q.b,Q.a)),v._15(17,573440,null,0,X.a,[[2,Y.a],E.a],{enabled:[0,"enabled"],error:[1,"error"]},{action:"action"}),(n()(),v._40(-1,null,["\n            "]))],function(n,e){var t=e.component;n(e,4,0,n(e,5,0,t.contacts),v._29(e.parent,48));n(e,8,0,n(e,9,0,t.nonContacts),v._29(e.parent,48));n(e,12,0,n(e,13,0,t.messages),v._29(e.parent,48));n(e,17,0,t.messages.canLoadMore,t.messages.loadMoreError)},null)}function o(n){return v._42(0,[(n()(),v._16(0,0,null,null,2,"core-empty-box",[["icon","search"]],null,null,null,nn.b,nn.a)),v._15(1,49152,null,0,en.a,[],{message:[0,"message"],icon:[1,"icon"]},null),v._32(131072,tn.a,[sn.a,v.i])],function(n,e){n(e,1,0,v._41(e,1,0,v._29(e,2).transform("core.noresults")),"search")},null)}function r(n){return v._42(0,[(n()(),v._16(0,0,null,null,2,"core-icon",[["name","fa-ban"]],null,null,null,ln.b,ln.a)),v._15(1,704512,null,0,an.a,[v.p,G.a],{name:[0,"name"],ariaLabel:[1,"ariaLabel"]},null),v._32(131072,tn.a,[sn.a,v.i])],function(n,e){n(e,1,0,"fa-ban",v._41(e,1,1,v._29(e,2).transform("addon.messages.contactblocked")))},null)}function u(n){return v._42(0,[(n()(),v._16(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),v._15(1,16384,null,0,on.a,[G.a,v.p,v.K],null,null),(n()(),v._40(2,null,["\n                ","\n            "])),v._34(3,1)],null,function(n,e){n(e,2,0,v._41(e,2,0,n(e,3,0,v._29(e.parent.parent.parent.parent,0),e.parent.context.$implicit.lastmessagedate)))})}function c(n){return v._42(0,[(n()(),v._16(0,0,null,null,2,"span",[["class","addon-message-last-message-user"]],null,null,null,null,null)),(n()(),v._40(1,null,["",""])),v._32(131072,tn.a,[sn.a,v.i])],null,function(n,e){n(e,1,0,v._41(e,1,0,v._29(e,2).transform("addon.messages.you")))})}function h(n){return v._42(0,[(n()(),v._16(0,0,null,null,31,"a",[["class","addon-message-discussion item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,e,t){var s=!0;if("click"===e){s=!1!==n.component.openConversation(n.context.$implicit)&&s}return s},rn.b,rn.a)),v._15(1,1097728,null,3,un.a,[cn.a,G.a,v.p,v.K,[2,hn.a]],null,null),v._37(335544320,6,{contentLabel:0}),v._37(603979776,7,{_buttons:1}),v._37(603979776,8,{_icons:1}),v._15(5,16384,null,0,dn.a,[],null,null),(n()(),v._40(-1,2,["\n            "])),(n()(),v._16(7,0,null,0,2,"ion-avatar",[["core-user-avatar",""],["item-start",""]],null,null,null,fn.b,fn.a)),v._15(8,770048,null,0,gn.a,[_n.a,y.a,pn.a,S.a,I.a,[2,C.a]],{user:[0,"user"],linkProfile:[1,"linkProfile"],checkOnline:[2,"checkOnline"]},null),v._15(9,16384,null,0,mn.a,[],null,null),(n()(),v._40(-1,2,["\n            "])),(n()(),v._16(11,0,null,2,7,"h2",[],null,null,null,null,null)),(n()(),v._40(-1,null,["\n                "])),(n()(),v._16(13,0,null,null,1,"core-format-text",[],null,null,null,null,null)),v._15(14,540672,null,0,vn.a,[v.p,y.a,E.a,bn.a,sn.a,z.a,pn.a,In.a,yn.a,Mn.a,S.a,Cn.a,[2,_n.a],[2,Y.a],[2,C.a],En.a,I.a],{text:[0,"text"],highlight:[1,"highlight"]},null),(n()(),v._40(-1,null,["\n                "])),(n()(),v._11(16777216,null,null,1,null,r)),v._15(17,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n            "])),(n()(),v._40(-1,2,["\n            "])),(n()(),v._11(16777216,null,2,1,null,u)),v._15(21,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,2,["\n            "])),(n()(),v._16(23,0,null,2,7,"p",[["class","addon-message-last-message"]],null,null,null,null,null)),(n()(),v._40(-1,null,["\n                "])),(n()(),v._11(16777216,null,null,1,null,c)),v._15(26,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n                "])),(n()(),v._16(28,0,null,null,1,"core-format-text",[["class","addon-message-last-message-text"],["clean","true"],["singleLine","true"]],null,null,null,null,null)),v._15(29,540672,null,0,vn.a,[v.p,y.a,E.a,bn.a,sn.a,z.a,pn.a,In.a,yn.a,Mn.a,S.a,Cn.a,[2,_n.a],[2,Y.a],[2,C.a],En.a,I.a],{text:[0,"text"],clean:[1,"clean"],singleLine:[2,"singleLine"],highlight:[3,"highlight"]},null),(n()(),v._40(-1,null,["\n            "])),(n()(),v._40(-1,2,["\n        "]))],function(n,e){n(e,8,0,e.context.$implicit,!1,!0);n(e,14,0,e.context.$implicit.fullname,e.context.$implicit.highlightName);n(e,17,0,e.context.$implicit.isblocked);n(e,21,0,e.context.$implicit.lastmessagedate>0);n(e,26,0,e.context.$implicit.sentfromcurrentuser);n(e,29,0,e.context.$implicit.lastmessage,"true","true",e.context.$implicit.highlightMessage)},function(n,e){n(e,0,0,e.context.$implicit.fullname,e.context.$implicit==e.component.selectedResult)})}function d(n){return v._42(0,[(n()(),v._16(0,0,null,null,6,"div",[["padding-horizontal",""]],null,null,null,null,null)),(n()(),v._40(-1,null,["\n                "])),(n()(),v._16(2,0,null,null,3,"button",[["block",""],["color","light"],["ion-button",""]],null,[[null,"click"]],function(n,e,t){var s=!0,l=n.component;if("click"===e){s=!1!==l.search(l.query,n.parent.parent.parent.context.item.type)&&s}return s},Sn.b,Sn.a)),v._15(3,1097728,null,0,On.a,[[8,""],G.a,v.p,v.K],{color:[0,"color"],block:[1,"block"]},null),(n()(),v._40(4,0,["\n                    ","\n                "])),v._32(131072,tn.a,[sn.a,v.i]),(n()(),v._40(-1,null,["\n            "]))],function(n,e){n(e,3,0,"light","")},function(n,e){n(e,4,0,v._41(e,4,0,v._29(e,5).transform("core.loadmore")))})}function f(n){return v._42(0,[(n()(),v._16(0,0,null,null,4,"div",[["padding",""],["text-center",""]],null,null,null,null,null)),(n()(),v._40(-1,null,["\n                "])),(n()(),v._16(2,0,null,null,1,"ion-spinner",[],[[2,"spinner-paused",null]],null,null,Dn.b,Dn.a)),v._15(3,114688,null,0,Un.a,[G.a,v.p,v.K],null,null),(n()(),v._40(-1,null,["\n            "]))],function(n,e){n(e,3,0)},function(n,e){n(e,2,0,v._29(e,3)._paused)})}function g(n){return v._42(0,[(n()(),v._16(0,0,null,null,7,null,null,null,null,null,null,null)),(n()(),v._40(-1,null,["\n            "])),(n()(),v._11(16777216,null,null,1,null,d)),v._15(3,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n            "])),(n()(),v._11(16777216,null,null,1,null,f)),v._15(6,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n        "]))],function(n,e){n(e,3,0,e.parent.parent.context.item.canLoadMore&&!e.parent.parent.context.item.loadingMore);n(e,6,0,e.parent.parent.context.item.loadingMore)},null)}function _(n){return v._42(0,[(n()(),v._16(0,0,null,null,18,null,null,null,null,null,null,null)),(n()(),v._40(-1,null,["\n        "])),(n()(),v._16(2,0,null,null,7,"ion-item-divider",[["class","item item-divider"],["text-wrap",""]],null,null,null,rn.b,rn.a)),v._15(3,1097728,null,3,un.a,[cn.a,G.a,v.p,v.K,[2,hn.a]],null,null),v._37(335544320,3,{contentLabel:0}),v._37(603979776,4,{_buttons:1}),v._37(603979776,5,{_icons:1}),v._15(7,16384,null,0,Pn.a,[G.a,v.p,v.K],null,null),(n()(),v._40(8,2,["",""])),v._32(131072,tn.a,[sn.a,v.i]),(n()(),v._40(-1,null,["\n\n        "])),(n()(),v._40(-1,null,["\n        "])),(n()(),v._11(16777216,null,null,1,null,h)),v._15(13,802816,null,0,Z.j,[v.W,v.T,v.v],{ngForOf:[0,"ngForOf"]},null),(n()(),v._40(-1,null,["\n\n        "])),(n()(),v._40(-1,null,["\n        "])),(n()(),v._11(16777216,null,null,1,null,g)),v._15(17,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n    "]))],function(n,e){n(e,13,0,e.parent.context.item.results);n(e,17,0,"messages"!=e.parent.context.item.type)},function(n,e){n(e,8,0,v._41(e,8,0,v._29(e,9).transform(e.parent.context.item.titleString)))})}function p(n){return v._42(0,[(n()(),v._40(-1,null,["\n    "])),(n()(),v._11(16777216,null,null,1,null,_)),v._15(2,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,null,["\n"]))],function(n,e){n(e,2,0,e.context.item.results.length>0)},null)}function m(n){return v._42(0,[v._32(0,xn.a,[yn.a,sn.a,kn.a]),v._37(402653184,1,{splitviewCtrl:0}),(n()(),v._16(2,0,null,null,21,"ion-header",[],null,null,null,null,null)),v._15(3,16384,null,0,Tn.a,[G.a,v.p,v.K,[2,wn.a]],null,null),(n()(),v._40(-1,null,["\n    "])),(n()(),v._16(5,0,null,null,17,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,Ln.b,Ln.a)),v._15(6,49152,null,0,Rn.a,[qn.a,[2,wn.a],[2,_n.a],G.a,v.p,v.K],null,null),v._15(7,212992,null,0,Nn.a,[Rn.a,z.a,sn.a,I.a],null,null),(n()(),v._40(-1,3,["\n        "])),(n()(),v._16(9,0,null,3,3,"ion-title",[],null,null,null,Wn.b,Wn.a)),v._15(10,49152,null,0,An.a,[G.a,v.p,v.K,[2,Kn.a],[2,Rn.a]],null,null),(n()(),v._40(11,0,["",""])),v._32(131072,tn.a,[sn.a,v.i]),(n()(),v._40(-1,3,["\n        "])),(n()(),v._16(14,0,null,2,7,"ion-buttons",[["end",""]],null,null,null,null,null)),v._15(15,16384,null,1,Vn.a,[G.a,v.p,v.K,[2,Kn.a],[2,Rn.a]],null,null),v._37(603979776,2,{_buttons:1}),(n()(),v._40(-1,null,["\n            "])),(n()(),v._40(-1,null,["\n            "])),(n()(),v._16(19,0,null,null,1,"core-context-menu",[],null,null,null,$n.b,$n.a)),v._15(20,245760,null,0,Bn.a,[sn.a,Hn.a,v.p,E.a,[2,Fn.a],pn.a],null,null),(n()(),v._40(-1,null,["\n        "])),(n()(),v._40(-1,3,["\n    "])),(n()(),v._40(-1,null,["\n"])),(n()(),v._40(-1,null,["\n"])),(n()(),v._16(25,0,null,null,20,"core-split-view",[],null,null,null,Gn.b,Gn.a)),v._15(26,245760,[[1,4]],0,C.a,[[2,_n.a],v.p,zn.a,z.a,sn.a],null,null),(n()(),v._40(-1,0,["\n    "])),(n()(),v._16(28,0,null,0,16,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,jn.b,jn.a)),v._15(29,4374528,null,0,Y.a,[G.a,z.a,J.a,v.p,v.K,qn.a,Jn.a,v.D,[2,wn.a],[2,_n.a]],null,null),(n()(),v._40(-1,1,["\n        "])),(n()(),v._16(31,0,null,1,1,"core-search-box",[["autocorrect","off"]],null,[[null,"onSubmit"],[null,"onClear"]],function(n,e,t){var s=!0,l=n.component;if("onSubmit"===e){s=!1!==l.search(t)&&s}if("onClear"===e){s=!1!==l.clearSearch(t)&&s}return s},Zn.b,Zn.a)),v._15(32,114688,null,0,Qn.a,[sn.a,pn.a],{autocorrect:[0,"autocorrect"],spellcheck:[1,"spellcheck"],autoFocus:[2,"autoFocus"],lengthCheck:[3,"lengthCheck"],disabled:[4,"disabled"]},{onSubmit:"onSubmit",onClear:"onClear"}),(n()(),v._40(-1,1,["\n        "])),(n()(),v._16(34,0,null,1,9,"core-loading",[],null,null,null,Xn.b,Xn.a)),v._15(35,638976,null,0,Yn.a,[sn.a,v.p,I.a,pn.a],{hideUntil:[0,"hideUntil"],message:[1,"message"]},null),v._32(131072,tn.a,[sn.a,v.i]),(n()(),v._40(-1,0,["\n            "])),(n()(),v._11(16777216,null,0,1,null,i)),v._15(39,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,0,["\n\n            "])),(n()(),v._11(16777216,null,0,1,null,o)),v._15(42,16384,null,0,Z.k,[v.W,v.T],{ngIf:[0,"ngIf"]},null),(n()(),v._40(-1,0,["\n        "])),(n()(),v._40(-1,1,["\n    "])),(n()(),v._40(-1,0,["\n"])),(n()(),v._40(-1,null,["\n\n"])),(n()(),v._40(-1,null,["\n"])),(n()(),v._11(0,[["resultsTemplate",2]],null,0,null,p))],function(n,e){var t=e.component;n(e,7,0),n(e,20,0),n(e,26,0);n(e,32,0,"off",!1,!0,1,t.disableSearch);n(e,35,0,!t.displaySearching,v._41(e,35,1,v._29(e,36).transform("core.searching")));n(e,39,0,t.displayResults);n(e,42,0,t.displayResults&&!t.contacts.results.length&&!t.nonContacts.results.length&&!t.messages.results.length)},function(n,e){n(e,5,0,v._29(e,6)._hidden,v._29(e,6)._sbPadding);n(e,11,0,v._41(e,11,0,v._29(e,12).transform("addon.messages.searchcombined")));n(e,28,0,v._29(e,29).statusbarPadding,v._29(e,29)._hasRefresher)})}Object.defineProperty(e,"__esModule",{value:!0});var v=t(1),b=(t(0),t(7),t(4)),I=t(12),y=t(2),M=t(154),C=t(26),E=t(5),S=t(10),O=function(){function n(n,e,t,s,l){var a=this;this.appProvider=n,this.domUtils=e,this.messagesProvider=l,this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.selectedResult=null,this.memberInfoObserver=t.on(M.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.userBlocked||n.userUnblocked){var e=a.contacts.results.find(function(e){return e.id==n.userId});if(e)e.isblocked=n.userBlocked;else{var t=a.nonContacts.results.find(function(e){return e.id==n.userId});t&&(t.isblocked=n.userBlocked)}a.messages.results.forEach(function(e){e.userid==n.userId&&(e.isblocked=n.userBlocked)})}},s.getCurrentSiteId())}return n.prototype.clearSearch=function(){this.query="",this.displayResults=!1,this.splitviewCtrl.emptyDetails()},n.prototype.search=function(n,e,t){var s=this;this.appProvider.closeKeyboard(),this.query=n,this.disableSearch=!0,this.displaySearching=!e;var l=[],a=[],i=[],o=[],r=!1,u=!1,c=!1;if(!e||"contacts"==e||"noncontacts"==e){var h=e?M.a.LIMIT_SEARCH:M.a.LIMIT_INITIAL_USER_SEARCH,d=0;"contacts"==e?(d=this.contacts.results.length,this.contacts.loadingMore=!0):"noncontacts"==e&&(d=this.nonContacts.results.length,this.nonContacts.loadingMore=!0),l.push(this.messagesProvider.searchUsers(n,d,h).then(function(n){e&&"contacts"!=e||(a=n.contacts,r=n.canLoadMoreContacts),e&&"noncontacts"!=e||(i=n.nonContacts,u=n.canLoadMoreNonContacts)}))}if(!e||"messages"==e){d=0;"messages"==e&&(d=this.messages.results.length,this.messages.loadingMore=!0),l.push(this.messagesProvider.searchMessages(n,void 0,d).then(function(n){o=n.messages,c=n.canLoadMore}))}return Promise.all(l).then(function(){e||(s.contacts.results=[],s.nonContacts.results=[],s.messages.results=[]),s.displayResults=!0,e&&"contacts"!=e||((n=s.contacts.results).push.apply(n,a),s.contacts.canLoadMore=r,s.setHighlight(a,!0)),e&&"noncontacts"!=e||((t=s.nonContacts.results).push.apply(t,i),s.nonContacts.canLoadMore=u,s.setHighlight(i,!0)),e&&"messages"!=e||((l=s.messages.results).push.apply(l,o),s.messages.canLoadMore=c,s.messages.loadMoreError=!1,s.setHighlight(o,!1)),e||(s.contacts.results.length>0?s.openConversation(s.contacts.results[0],!0):s.nonContacts.results.length>0?s.openConversation(s.nonContacts.results[0],!0):s.messages.results.length>0&&s.openConversation(s.messages.results[0],!0));var n,t,l}).catch(function(n){s.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingusers",!0),"messages"==e&&(s.messages.loadMoreError=!0)}).finally(function(){s.disableSearch=!1,s.displaySearching=!1,"contacts"==e?s.contacts.loadingMore=!1:"noncontacts"==e?s.nonContacts.loadingMore=!1:"messages"==e&&(s.messages.loadingMore=!1),t&&t()})},n.prototype.openConversation=function(n,e){if(void 0===e&&(e=!1),!e||this.splitviewCtrl.isOn()){this.selectedResult=n;var t={};n.conversationid?t.conversationId=n.conversationid:t.userId=n.id,this.splitviewCtrl.push("AddonMessagesDiscussionPage",t)}},n.prototype.setHighlight=function(n,e){var t=this;n.forEach(function(n){n.highlightName=e?t.query:void 0,n.highlightMessage=e?void 0:t.query})},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}(),D=t(30),U=t(32),P=t(110),x=t(2103),k=function(){return function(){}}(),T=t(1471),w=t(1472),L=t(1473),R=t(1474),q=t(1475),N=t(1476),W=t(1477),A=t(1478),K=t(1479),V=t(1480),$=t(1481),B=t(1482),H=t(1483),F=t(83),G=t(8),z=t(17),j=t(40),J=t(34),Z=t(9),Q=t(369),X=t(270),Y=t(27),nn=t(122),en=t(111),tn=t(28),sn=t(19),ln=t(112),an=t(95),on=t(223),rn=t(31),un=t(22),cn=t(21),hn=t(29),dn=t(33),fn=t(211),gn=t(180),_n=t(20),pn=t(3),mn=t(153),vn=t(42),bn=t(11),In=t(24),yn=t(6),Mn=t(18),Cn=t(14),En=t(38),Sn=t(45),On=t(43),Dn=t(129),Un=t(113),Pn=t(94),xn=t(309),kn=t(25),Tn=t(365),wn=t(39),Ln=t(713),Rn=t(209),qn=t(35),Nn=t(471),Wn=t(714),An=t(307),Kn=t(245),Vn=t(366),$n=t(86),Bn=t(75),Hn=t(66),Fn=t(73),Gn=t(472),zn=t(69),jn=t(179),Jn=t(102),Zn=t(1498),Qn=t(484),Xn=t(51),Yn=t(48),ne=v._14({encapsulation:2,styles:[],data:{}}),ee=v._12("page-addon-messages-search",O,function(n){return v._42(0,[(n()(),v._16(0,0,null,null,1,"page-addon-messages-search",[],null,null,null,m,ne)),v._15(1,180224,null,0,O,[S.a,E.a,I.a,y.a,M.a],null,null)],null,null)},{},{},[]),te=t(23),se=t(361),le=t(362),ae=t(364),ie=t(363),oe=t(470),re=t(712),ue=t(268);t.d(e,"AddonMessagesSearchPageModuleNgFactory",function(){return ce});var ce=v._13(k,[],function(n){return v._25([v._26(512,v.n,v._6,[[8,[T.a,w.a,L.a,R.a,q.a,N.a,W.a,A.a,K.a,V.a,$.a,B.a,H.a,ee]],[3,v.n],v.B]),v._26(4608,Z.m,Z.l,[v.x,[2,Z.w]]),v._26(4608,te.x,te.x,[]),v._26(4608,te.d,te.d,[]),v._26(4608,se.b,se.a,[]),v._26(4608,le.a,le.b,[]),v._26(4608,ae.b,ae.a,[]),v._26(4608,ie.b,ie.a,[]),v._26(4608,sn.a,sn.a,[oe.a,se.b,le.a,ae.b,ie.b,sn.b,sn.c]),v._26(512,Z.b,Z.b,[]),v._26(512,te.v,te.v,[]),v._26(512,te.i,te.i,[]),v._26(512,te.s,te.s,[]),v._26(512,re.a,re.a,[]),v._26(512,b.a,b.a,[]),v._26(512,U.a,U.a,[]),v._26(512,P.a,P.a,[]),v._26(512,D.a,D.a,[]),v._26(512,x.a,x.a,[]),v._26(512,re.b,re.b,[]),v._26(512,k,k,[]),v._26(256,sn.c,void 0,[]),v._26(256,sn.b,void 0,[]),v._26(256,ue.a,O,[])])})},2103:function(n,e,t){"use strict";t.d(e,"a",function(){return s});t(0),t(7),t(4),t(30),t(32),t(110),t(2104),t(2105),t(2106),t(2107);var s=function(){return function(){}}()},2104:function(n,e,t){"use strict";t.d(e,"a",function(){return l});t(0),t(7),t(4),t(12),t(2);var s=t(154),l=(t(5),t(3),t(10),t(137),function(){function n(n,e,t,l,a,i,o,r,u,c){var h=this;this.eventsProvider=n,this.messagesProvider=l,this.domUtils=a,this.appProvider=o,this.utils=u,this.loaded=!1,this.search={enabled:!1,showResults:!1,results:[],loading:"",text:""},this.search.loading=t.instant("core.searching"),this.loadingMessages=t.instant("core.loading"),this.siteId=e.getCurrentSiteId(),this.newMessagesObserver=n.on(s.a.NEW_MESSAGE_EVENT,function(n){if(n.userId&&h.discussions){var e=h.discussions.find(function(e){return e.message.user==n.userId});void 0===e?(h.loaded=!1,h.refreshData().finally(function(){h.loaded=!0})):(e.message.message=n.message,e.message.timecreated=n.timecreated)}},this.siteId),this.readChangedObserver=n.on(s.a.READ_CHANGED_EVENT,function(n){if(n.userId&&h.discussions){var e=h.discussions.find(function(e){return e.message.user==n.userId});void 0!==e&&(e.unread=!1,h.messagesProvider.invalidateConversations(h.siteId),h.messagesProvider.refreshUnreadConversationCounts(h.siteId))}},this.siteId),this.appResumeSubscription=r.resume.subscribe(function(){h.loaded&&(h.loaded=!1,h.refreshData())}),this.discussionUserId=i.get("discussionUserId")||!1,this.pushObserver=c.on("receive").subscribe(function(n){u.isFalseOrZero(n.notif)&&n.site==h.siteId&&h.refreshData(null,!1)})}return n.prototype.ngOnInit=function(){var n=this;this.discussionUserId&&this.gotoDiscussion(this.discussionUserId),this.fetchData().then(function(){!n.discussionUserId&&n.discussions.length>0&&n.gotoDiscussion(n.discussions[0].message.user,void 0,!0)})},n.prototype.refreshData=function(n,e){var t=this;void 0===e&&(e=!0);var s=[];return s.push(this.messagesProvider.invalidateDiscussionsCache(this.siteId)),e&&s.push(this.messagesProvider.invalidateUnreadConversationCounts(this.siteId)),this.utils.allPromises(s).finally(function(){return t.fetchData().finally(function(){n&&n.complete()})})},n.prototype.fetchData=function(){var n=this;this.loadingMessage=this.loadingMessages,this.search.enabled=this.messagesProvider.isSearchMessagesEnabled();var e=[];return e.push(this.messagesProvider.getDiscussions(this.siteId).then(function(e){var t=[];for(var s in e)e[s].unread=!!e[s].unread,t.push(e[s]);n.discussions=t.sort(function(n,e){return e.message.timecreated-n.message.timecreated})})),e.push(this.messagesProvider.getUnreadConversationCounts(this.siteId)),Promise.all(e).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}).finally(function(){n.loaded=!0})},n.prototype.clearSearch=function(){var n=this;this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally(function(){n.loaded=!0})},n.prototype.searchMessage=function(n){var e=this;return this.appProvider.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.search.loading,this.messagesProvider.searchMessages(n,void 0,void 0,void 0,this.siteId).then(function(n){e.search.showResults=!0,e.search.results=n.messages}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){e.loaded=!0})},n.prototype.gotoDiscussion=function(n,e,t){void 0===t&&(t=!1),this.discussionUserId=n;var l={discussion:n,onlyWithSplitView:t};e&&(l.message=e),this.eventsProvider.trigger(s.a.SPLIT_VIEW_LOAD_EVENT,l,this.siteId)},n.prototype.ngOnDestroy=function(){this.newMessagesObserver&&this.newMessagesObserver.off(),this.readChangedObserver&&this.readChangedObserver.off(),this.cronObserver&&this.cronObserver.off(),this.appResumeSubscription&&this.appResumeSubscription.unsubscribe(),this.pushObserver&&this.pushObserver.unsubscribe()},n}())},2105:function(n,e,t){"use strict";t.d(e,"a",function(){return a});t(0);var s=t(1),l=(t(7),t(12),t(2),t(154)),a=(t(5),function(){function n(n,e,t,a){var i=this;this.domUtils=n,this.messagesProvider=a,this.onUserSelected=new s.r,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.contacts=[],this.onUserSelected=new s.r,this.memberInfoObserver=e.on(l.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.userBlocked||n.userUnblocked){var e=i.contacts.find(function(e){return e.id==n.userId});e&&(e.isblocked=n.userBlocked)}else if(n.contactRemoved){var t=i.contacts.findIndex(function(e){return e.id==n.userId});t>=0&&i.contacts.splice(t,1)}else n.contactRequestConfirmed&&i.refreshData()},t.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.fetchData().then(function(){n.contacts.length&&n.selectUser(n.contacts[0].id,!0)}).finally(function(){n.loaded=!0}),this.content.resize()},n.prototype.fetchData=function(n){var e=this;void 0===n&&(n=!1),this.loadMoreError=!1;var t=n?0:this.contacts.length;return(0===t?this.messagesProvider.invalidateUserContacts().catch(function(){}):Promise.resolve()).then(function(){return e.messagesProvider.getUserContacts(t)}).then(function(t){e.contacts=n?t.contacts:e.contacts.concat(t.contacts),e.canLoadMore=t.canLoadMore}).catch(function(n){e.loadMoreError=!0,e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.refreshData=function(n){return this.fetchData(!0).finally(function(){n&&n.complete()})},n.prototype.loadMore=function(n){return this.fetchData().finally(function(){n&&n()})},n.prototype.selectUser=function(n,e){void 0===e&&(e=!1),this.selectedUserId=n,this.onUserSelected.emit({userId:n,onInit:e})},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())},2106:function(n,e,t){"use strict";t.d(e,"a",function(){return a});t(0);var s=t(1),l=(t(7),t(12),t(2),t(154)),a=(t(5),function(){function n(n,e,t,a){var i=this;this.domUtils=n,this.messagesProvider=a,this.onUserSelected=new s.r,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.requests=[],this.memberInfoObserver=e.on(l.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.contactRequestConfirmed||n.contactRequestDeclined){var e=i.requests.findIndex(function(e){return e.id==n.userId});e>=0&&i.requests.splice(e,1)}},t.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.fetchData().then(function(){n.requests.length&&n.selectUser(n.requests[0].id,!0)}).finally(function(){n.loaded=!0}),this.content.resize()},n.prototype.fetchData=function(n){var e=this;void 0===n&&(n=!1),this.loadMoreError=!1;var t=n?0:this.requests.length;return(0===t?this.messagesProvider.invalidateContactRequestsCache().catch(function(){}):Promise.resolve()).then(function(){return e.messagesProvider.getContactRequests(t)}).then(function(t){e.requests=n?t.requests:e.requests.concat(t.requests),e.canLoadMore=t.canLoadMore}).catch(function(n){e.loadMoreError=!0,e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.refreshData=function(n){return this.messagesProvider.refreshContactRequestsCount(),this.fetchData(!0).finally(function(){n&&n.complete()})},n.prototype.loadMore=function(n){return this.fetchData().finally(function(){n&&n()})},n.prototype.selectUser=function(n,e){void 0===e&&(e=!1),this.selectedUserId=n,this.onUserSelected.emit({userId:n,onInit:e})},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())},2107:function(n,e,t){"use strict";t.d(e,"a",function(){return l});t(0),t(7),t(4),t(2);var s=t(154),l=(t(5),t(10),t(12),function(){function n(n,e,t,l,a,i,o){var r=this;this.appProvider=t,this.messagesProvider=l,this.domUtils=a,this.eventsProvider=o,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=this.noSearchTypes,this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={search:[]},this.searchString="",this.currentUserId=n.getCurrentSiteUserId(),this.siteId=n.getCurrentSiteId(),this.searchingMessages=e.instant("core.searching"),this.loadingMessages=e.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.discussionUserId=i.get("discussionUserId")||!1,this.memberInfoObserver=o.on(s.a.MEMBER_INFO_CHANGED_EVENT,function(n){n.contactRequestConfirmed&&r.refreshData()},n.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.discussionUserId&&this.gotoDiscussion(this.discussionUserId),this.fetchData().then(function(){if(!n.discussionUserId&&n.hasContacts){var e=void 0;for(var t in n.contacts)if(n.contacts[t].length>0){e=n.contacts[t][0];break}e&&n.gotoDiscussion(e.id,!0)}}).finally(function(){n.loaded=!0})},n.prototype.refreshData=function(n){var e=this;return(this.searchString?this.performSearch(this.searchString):this.messagesProvider.invalidateAllContactsCache(this.currentUserId).then(function(){return e.fetchData()})).finally(function(){n.complete()})},n.prototype.fetchData=function(){var n=this;return this.loadingMessage=this.loadingMessages,this.messagesProvider.getAllContacts().then(function(e){for(var t in e)n.contacts[t]=e[t].length>0?n.sortUsers(e[t]):[];n.clearSearch()}).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.sortUsers=function(n){return n.sort(function(n,e){var t=n.fullname.toLowerCase(),s=e.fullname.toLowerCase();return t.localeCompare(s)})},n.prototype.clearSearch=function(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(var n in this.contacts)if(this.contacts[n].length>0)return void(this.hasContacts=!0)},n.prototype.search=function(n){var e=this;return this.appProvider.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(n).finally(function(){e.loaded=!0})},n.prototype.performSearch=function(n){var e=this;return this.messagesProvider.searchContacts(n).then(function(t){e.hasContacts=t.length>0,e.searchString=n,e.contactTypes=["search"],e.contacts.search=e.sortUsers(t)}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.gotoDiscussion=function(n,e){void 0===e&&(e=!1),this.discussionUserId=n;this.eventsProvider.trigger(s.a.SPLIT_VIEW_LOAD_EVENT,{discussion:n,onlyWithSplitView:e},this.siteId)},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())}});