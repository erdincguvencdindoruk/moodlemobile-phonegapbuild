webpackJsonp([40],{2049:function(l,n,e){"use strict";function t(l){return u._42(0,[(l()(),u._16(0,0,null,null,33,"ion-item",[["class","item item-block"]],[[2,"core-primary-selected-item",null]],null,null,C.b,C.a)),u._15(1,1097728,null,3,K.a,[k.a,F.a,u.p,u.K,[2,L.a]],null,null),u._37(335544320,1,{contentLabel:0}),u._37(603979776,2,{_buttons:1}),u._37(603979776,3,{_icons:1}),u._15(5,16384,null,0,I.a,[],null,null),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(7,0,null,2,2,"h2",[["text-wrap",""]],null,null,null,null,null)),(l()(),u._16(8,0,null,null,1,"core-format-text",[],null,null,null,null,null)),u._15(9,540672,null,0,N.a,[u.p,s.a,_.a,c.a,O.a,A.a,M.a,j.a,z.a,o.a,r.a,B.a,[2,J.a],[2,V.a],[2,W.a],q.a,G.a],{text:[0,"text"]},null),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(11,0,null,2,1,"p",[["text-wrap",""]],null,null,null,null,null)),(l()(),u._40(12,null,["",""])),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(14,0,null,4,10,"div",[["item-end",""]],null,null,null,null,null)),(l()(),u._40(-1,null,["\n                "])),(l()(),u._16(16,0,null,null,2,"p",[],null,null,null,null,null)),(l()(),u._40(17,null,["",""])),u._34(18,1),(l()(),u._40(-1,null,["\n                "])),(l()(),u._16(20,0,null,null,3,"p",[],null,null,null,null,null)),(l()(),u._40(21,null,["",""])),u._33(22,{$a:0}),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,null,["\n            "])),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(26,0,null,4,6,"button",[["clear",""],["color","danger"],["icon-only",""],["ion-button",""],["item-end",""]],[[8,"hidden",0],[1,"aria-label",0]],[[null,"click"]],function(l,n,e){var t=!0;if("click"===n){t=!1!==l.component.deleteSiteStorage(l.context.$implicit)&&t}return t},Q.b,Q.a)),u._15(27,1097728,[[2,4]],0,X.a,[[8,""],F.a,u.p,u.K],{color:[0,"color"],clear:[1,"clear"]},null),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,0,["\n                "])),(l()(),u._16(30,0,null,0,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),u._15(31,147456,null,0,Y.a,[F.a,u.p,u.K],{name:[0,"name"]},null),(l()(),u._40(-1,0,["\n            "])),(l()(),u._40(-1,2,["\n        "]))],function(l,n){l(n,9,0,n.context.$implicit.siteName);l(n,27,0,"danger","");l(n,31,0,"trash")},function(l,n){l(n,0,0,n.context.$implicit.id==n.component.currentSiteId);l(n,12,0,n.context.$implicit.fullName);l(n,17,0,u._41(n,17,0,l(n,18,0,u._29(n.parent,0),n.context.$implicit.spaceUsage)));l(n,21,0,u._41(n,21,0,u._29(n,23).transform("core.settings.entriesincache",l(n,22,0,n.context.$implicit.cacheEntries))));l(n,26,0,!n.context.$implicit.spaceUsage>"0"&&!n.context.$implicit.cacheEntries>"0",u._41(n,26,1,u._29(n,28).transform("core.settings.deletesitefilestitle")));l(n,30,0,u._29(n,31)._hidden)})}function a(l){return u._42(0,[u._32(0,Z.a,[z.a,c.a]),(l()(),u._16(1,0,null,null,12,"ion-header",[],null,null,null,null,null)),u._15(2,16384,null,0,ll.a,[F.a,u.p,u.K,[2,nl.a]],null,null),(l()(),u._40(-1,null,["\n    "])),(l()(),u._16(4,0,null,null,8,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,el.b,el.a)),u._15(5,49152,null,0,tl.a,[al.a,[2,nl.a],[2,J.a],F.a,u.p,u.K],null,null),u._15(6,212992,null,0,ul.a,[tl.a,A.a,O.a,G.a],null,null),(l()(),u._40(-1,3,["\n        "])),(l()(),u._16(8,0,null,3,3,"ion-title",[],null,null,null,il.b,il.a)),u._15(9,49152,null,0,rl.a,[F.a,u.p,u.K,[2,ol.a],[2,tl.a]],null,null),(l()(),u._40(10,0,["",""])),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,3,["\n    "])),(l()(),u._40(-1,null,["\n"])),(l()(),u._40(-1,null,["\n"])),(l()(),u._16(15,0,null,null,41,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,sl.b,sl.a)),u._15(16,4374528,null,0,V.a,[F.a,A.a,cl.a,u.p,u.K,al.a,_l.a,u.D,[2,nl.a],[2,J.a]],null,null),(l()(),u._40(-1,1,["\n    "])),(l()(),u._16(18,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(l,n,e){var t=!0;if("ionRefresh"===n){t=!1!==l.component.refreshData(e)&&t}return t},null,null)),u._15(19,212992,null,0,dl.a,[A.a,V.a,u.D,pl.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(l()(),u._40(-1,null,["\n        "])),(l()(),u._16(21,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,fl.b,fl.a)),u._15(22,114688,null,0,hl.a,[dl.a,F.a],{pullingText:[0,"pullingText"]},null),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,null,["\n    "])),(l()(),u._40(-1,1,["\n    "])),(l()(),u._16(26,0,null,1,29,"core-loading",[],null,null,null,gl.b,gl.a)),u._15(27,638976,null,0,ml.a,[O.a,u.p,G.a,M.a],{hideUntil:[0,"hideUntil"]},null),(l()(),u._40(-1,0,["\n        "])),(l()(),u._11(16777216,null,0,1,null,t)),u._15(30,802816,null,0,bl.j,[u.W,u.T,u.v],{ngForOf:[0,"ngForOf"]},null),(l()(),u._40(-1,0,["\n        "])),(l()(),u._16(32,0,null,0,22,"ion-item-divider",[["class","item item-divider"]],null,null,null,C.b,C.a)),u._15(33,1097728,null,3,K.a,[k.a,F.a,u.p,u.K,[2,L.a]],null,null),u._37(335544320,4,{contentLabel:0}),u._37(603979776,5,{_buttons:1}),u._37(603979776,6,{_icons:1}),u._15(37,16384,null,0,vl.a,[F.a,u.p,u.K],null,null),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(39,0,null,2,2,"p",[],null,null,null,null,null)),(l()(),u._40(40,null,["",""])),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,2,["\n            "])),(l()(),u._16(43,0,null,4,10,"div",[["item-end",""]],null,null,null,null,null)),(l()(),u._40(-1,null,["\n                "])),(l()(),u._16(45,0,null,null,2,"p",[],null,null,null,null,null)),(l()(),u._40(46,null,["",""])),u._34(47,1),(l()(),u._40(-1,null,["\n                "])),(l()(),u._16(49,0,null,null,3,"p",[],null,null,null,null,null)),(l()(),u._40(50,null,["",""])),u._33(51,{$a:0}),u._32(131072,H.a,[O.a,u.i]),(l()(),u._40(-1,null,["\n            "])),(l()(),u._40(-1,2,["\n        "])),(l()(),u._40(-1,0,["\n    "])),(l()(),u._40(-1,1,["\n"])),(l()(),u._40(-1,null,["\n"]))],function(l,n){var e=n.component;l(n,6,0);l(n,19,0,e.usageLoaded);l(n,22,0,u._19(1,"",u._41(n,22,0,u._29(n,23).transform("core.pulltorefresh")),""));l(n,27,0,e.usageLoaded);l(n,30,0,e.sites)},function(l,n){var e=n.component;l(n,4,0,u._29(n,5)._hidden,u._29(n,5)._sbPadding);l(n,10,0,u._41(n,10,0,u._29(n,11).transform("core.settings.spaceusage")));l(n,15,0,u._29(n,16).statusbarPadding,u._29(n,16)._hasRefresher);l(n,18,0,"inactive"!==u._29(n,19).state,u._29(n,19)._top);l(n,21,0,u._29(n,22).r.state);l(n,40,0,u._41(n,40,0,u._29(n,41).transform("core.settings.total")));l(n,46,0,u._41(n,46,0,l(n,47,0,u._29(n,0),e.totalUsage)));l(n,50,0,u._41(n,50,0,u._29(n,52).transform("core.settings.entriesincache",l(n,51,0,e.totalEntries))))})}Object.defineProperty(n,"__esModule",{value:!0});var u=e(1),i=(e(0),e(7),e(4)),r=e(10),o=e(18),s=e(2),c=e(11),_=e(5),d=e(15),p=function(){function l(l,n,e,t,a,u,i){this.filePoolProvider=l,this.sitesProvider=n,this.textUtils=e,this.translate=t,this.domUtils=a,this.courseProvider=i,this.usageLoaded=!1,this.sites=[],this.currentSiteId="",this.totalUsage=0,this.totalEntries=0,this.currentSiteId=this.sitesProvider.getCurrentSiteId()}return l.prototype.ionViewDidLoad=function(){var l=this;this.fetchData().finally(function(){l.usageLoaded=!0})},l.prototype.calculateSizeUsage=function(){var l=this;return this.sitesProvider.getSortedSites().then(function(n){l.sites=n;var e=l.sites.map(function(n){return l.sitesProvider.getSite(n.id).then(function(e){var t=[];return t.push(l.calcSiteClearRows(e).then(function(l){n.cacheEntries=l})),t.push(e.getSpaceUsage().then(function(l){n.spaceUsage=l})),Promise.all(t)})});return Promise.all(e)})},l.prototype.calculateTotalUsage=function(){var l=0,n=0;this.sites.forEach(function(e){l+=e.spaceUsage?parseInt(e.spaceUsage,10):0,n+=e.cacheEntries?parseInt(e.cacheEntries,10):0}),this.totalUsage=l,this.totalEntries=n},l.prototype.fetchData=function(){var l=this,n=[this.calculateSizeUsage().then(function(){return l.calculateTotalUsage()})];return Promise.all(n)},l.prototype.refreshData=function(l){this.fetchData().finally(function(){l.complete()})},l.prototype.updateSiteUsage=function(l,n){var e=l.spaceUsage;l.spaceUsage=n,this.totalUsage-=e-n},l.prototype.calcSiteClearRows=function(l){var n=0,e=this.sitesProvider.getSiteTableSchemasToClear().map(function(e){return l.getDb().countRecords(e).then(function(l){n+=l})});return Promise.all(e).then(function(){return n})},l.prototype.deleteSiteStorage=function(l){var n=this;this.textUtils.formatText(l.siteName).then(function(e){var t=n.translate.instant("core.settings.deletesitefilestitle"),a=n.translate.instant("core.settings.deletesitefiles",{sitename:e});n.domUtils.showConfirm(a,t).then(function(){return n.sitesProvider.getSite(l.id)}).then(function(e){var t=n.sitesProvider.getSiteTableSchemasToClear().map(function(l){return e.getDb().deleteRecords(l)});return t.push(e.deleteFolder().then(function(){n.filePoolProvider.clearAllPackagesStatus(e.id),n.filePoolProvider.clearFilepool(e.id),n.updateSiteUsage(l,0),n.courseProvider.clearAllCoursesStatus(e.id)}).catch(function(t){t&&t.code===FileError.NOT_FOUND_ERR?(n.filePoolProvider.clearAllPackagesStatus(e.id),n.updateSiteUsage(l,0)):(n.domUtils.showErrorModal("core.settings.errordeletesitefiles",!0),e.getSpaceUsage().then(function(e){n.updateSiteUsage(l,e)}))}).finally(function(){n.calcSiteClearRows(e).then(function(n){l.cacheEntries=n})})),Promise.all(t)}).catch(function(){})})},l}(),f=e(30),h=e(32),g=e(110),m=function(){return function(){}}(),b=e(1471),v=e(1472),S=e(1473),U=e(1474),P=e(1475),x=e(1476),y=e(1477),E=e(1478),R=e(1479),D=e(1480),T=e(1481),w=e(1482),$=e(1483),C=e(31),K=e(22),k=e(21),F=e(8),L=e(29),I=e(33),N=e(42),O=e(19),A=e(17),M=e(3),j=e(24),z=e(6),B=e(14),J=e(20),V=e(27),W=e(26),q=e(38),G=e(12),H=e(28),Q=e(45),X=e(43),Y=e(47),Z=e(1526),ll=e(365),nl=e(39),el=e(713),tl=e(209),al=e(35),ul=e(471),il=e(714),rl=e(309),ol=e(245),sl=e(179),cl=e(34),_l=e(102),dl=e(152),pl=e(40),fl=e(210),hl=e(168),gl=e(51),ml=e(48),bl=e(9),vl=e(94),Sl=u._14({encapsulation:2,styles:[],data:{}}),Ul=u._12("page-core-settings-space-usage",p,function(l){return u._42(0,[(l()(),u._16(0,0,null,null,1,"page-core-settings-space-usage",[],null,null,null,a,Sl)),u._15(1,49152,null,0,p,[o.a,s.a,c.a,O.a,_.a,r.a,d.a],null,null)],null,null)},{},{},[]),Pl=e(23),xl=e(361),yl=e(362),El=e(364),Rl=e(363),Dl=e(470),Tl=e(712),wl=e(269);e.d(n,"CoreSettingsSpaceUsagePageModuleNgFactory",function(){return $l});var $l=u._13(m,[],function(l){return u._25([u._26(512,u.n,u._6,[[8,[b.a,v.a,S.a,U.a,P.a,x.a,y.a,E.a,R.a,D.a,T.a,w.a,$.a,Ul]],[3,u.n],u.B]),u._26(4608,bl.m,bl.l,[u.x,[2,bl.w]]),u._26(4608,Pl.x,Pl.x,[]),u._26(4608,Pl.d,Pl.d,[]),u._26(4608,xl.b,xl.a,[]),u._26(4608,yl.a,yl.b,[]),u._26(4608,El.b,El.a,[]),u._26(4608,Rl.b,Rl.a,[]),u._26(4608,O.a,O.a,[Dl.a,xl.b,yl.a,El.b,Rl.b,O.b,O.c]),u._26(512,bl.b,bl.b,[]),u._26(512,Pl.v,Pl.v,[]),u._26(512,Pl.i,Pl.i,[]),u._26(512,Pl.s,Pl.s,[]),u._26(512,Tl.a,Tl.a,[]),u._26(512,i.a,i.a,[]),u._26(512,h.a,h.a,[]),u._26(512,g.a,g.a,[]),u._26(512,f.a,f.a,[]),u._26(512,Tl.b,Tl.b,[]),u._26(512,m,m,[]),u._26(256,O.c,void 0,[]),u._26(256,O.b,void 0,[]),u._26(256,wl.a,p,[])])})}});